<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>dropdown</title>
        <script src="../d3.js"></script>
        <style>
            /*put some styles here to make buttons and inputs more prominent*/
        </style>
	</head>
	<body>
		<script type="text/javascript">

			var dataset = null;

			//Width and height
			var w = 1400;
			var h = 600;
			var barPadding = 1;

			var dataset, xScale, yScale, xAxis, yAxis;

			var svg = d3.select("body")
						.append("svg")
						.attr("width", w)
						.attr("height", h);

			d3.csv("honzawatakashi_431618_12467881_IMDd-movies-sorted-by-year.csv")
				.then(function(data) {
					moviesSortByYear = d3.nest()
						.key(function(d) {return d.year;})
						.entries(data);
					
					let optimized = []
						
					for (element of moviesSortByYear){	
						const newObj = {
							year: element.key,
							numOfMovie: element.values.length
						}
						optimized.push(newObj)
					}

					console.log(optimized)
					/*
					xScale = d3.scaleBand()
						.domain(d3.range(optimized.length))
						.rangeRound([0, w])
						.paddingInner(0.05);
					yScale = d3.scaleLinear()
						.domain([0, d3.max(optimized.numOfMovie)])
						.range([0, h]);
					*/ 

					svg.selectAll("rect")
         			   	.data(optimized)
         			   	.enter()
         			   	.append("rect")
						.attr("x", function(d, i) {
         			   		return i * (w / optimized.length);
         			   	})
         			   	.attr("y", function(d) {
         			   		return h - (d.numOfMovie / 6);
         			   	})
         			   	.attr("width", w / optimized.length - barPadding)
         			   	.attr("height", function(d) {
         			   		return (d.numOfMovie / 6);
         			   	})
         			   	.attr("fill", "#44F5AB")
						.on("click", function() {
			   				sortBars();
			   			})
						
					var sortOrder = false;
						
					var sortBars = function() {
						sortOrder = !sortOrder;

						svg.selectAll("rect")
							.sort(function(a, b) {
								return d3.ascending(a.numOfMovie, b.numOfMovie)
							})
								
							.sort(function(a, b) {
								if(sortOrder){
									return d3.ascending(a.numOfMovie, b.numOfMovie);
								} else {
									return d3.descending(a.numOfMovie, b.numOfMovie)
								}
							})
								
							.transition()
							.duration(1000)
							.attr("x", function(d, i) {
								return i * (w / moviesSortByYear.length);
							})
						};	
		
				})
		</script>
	</body>
</html>