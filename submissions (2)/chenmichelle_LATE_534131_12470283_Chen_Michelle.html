<!DOCTYPE html>
<html>
<head>
     <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="../favicon.ico" rel="shortcut icon" type="image/x-icon" />
    <title>basic basemap</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script type="text/javascript" src="../d3.js"></script>

</head>
<body>
    
</div>
		<script type="text/javascript"> 
        var width = window.innerWidth
        var height = window.innerHeight

        var svg = d3.select("body")
			.append("svg").attr("width",width)
			.attr("height", height);           

        var geoPath = "nyc_boroughs.geojson";
        var dataPath = "BuildingAge.csv";

        Promise.all([d3.json(geoPath), d3.csv(dataPath)]).then(function(data) {
                var geo = data[0];
                var places = data[1];
                drawOutline(geo)
                drawDots(places,geo)
            });
            
            function drawOutline(geo){
                var padding = 10
                var myProjection = d3.geoAlbers()
                      
.fitExtent([[padding,padding],[width-padding,height-padding]],geo)
               
			    var path = d3.geoPath().projection(myProjection);
               
			    svg.append("path")
                    .attr("d", path(geo))
                    .attr("fill", "none")
                    .attr("stroke", "#000000")
                    .attr("stroke-width",.5)
            }
            
			
            function drawDots(places,geo){              
                var padding = 10
                var projection = d3.geoAlbers()
                        .fitExtent([[padding,padding],[width-padding,height-padding]],geo)
        
              var propertyDictionary = {}
              var propertyCoordinates = {}
			  var propertyEnergy = {}
              
			  
              for(var p in places){
                var propertyId = places[p]["Property Id"]                
                var currentKeys = Object.keys(propertyDictionary)
                
				  if(currentKeys.indexOf(propertyId)==-1){
                  propertyDictionary[propertyId]=1
                  propertyCoordinates[propertyId]=[places[p]["Latitude"],places[p]["Longitude"]]
				propertyEnergy[propertyId] = places[p]["Site EUI (kBtu/ftÂ²)"]
                }else{
                  propertyDictionary[propertyId]+=1
                }
              }
			  //var rScale = d3.scaleLinear().domain([1,300]).range([3,10])
                      
				/*var xscale = d3.scaleLinear()
			.domain([d3.min(places, function(d){
				return d.latitude;
			}), d3.max(places, function(d){
				return d.latitude;
			})])
			.range([0, width-padding]);
			
			var yscale = d3.scaleLinear()
			.domain([d3.min(places, function(d){
				return d.longitude;
			}), d3.max(places, function(d){
				return d.longitude;
			})])       
			.range([height-padding, 0]);*/
			
 			 var xscale = d3.scaleLinear()
  			.domain([-74.244118,-73.7700935])
  			.range([0, width-padding]);
			
  			var yscale = d3.scaleLinear()
  			.domain([40.508319,40.912869])       
  			.range([height-padding, 0]);
			
			var myColor = d3.scaleLinear()
			.range(["white", "#69b3a2"])
			.domain([0,200]);
			
                svg.selectAll("circle")
                	.data(Object.keys(propertyDictionary))
                    .enter()
                	.append("circle")
                	.attr("r", 1)
                	.attr("cx", function(d) {
                  	    return projection([propertyCoordinates[d][1],propertyCoordinates[d][0]])[0]
                	})
                	.attr("cy", function(d) {
                  	    return projection([propertyCoordinates[d][1],propertyCoordinates[d][0]])[1]
                	})
					.attr("fill", function(d) {
						return myColor(propertyEnergy[d])
					})
					.attr("opacity", 1)
				//	.on("mouseover",....)
			//  svg.selectAll()
            console.log()
			}
</script>
</body>
</html>